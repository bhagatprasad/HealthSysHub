<div class="content-wrapper pb-0">
    <div class="page-header flex-wrap">
        <div class="d-flex flex-wrap justify-content-between w-100 align-items-center">
            <!-- Left side - Single button -->
            <div class="header-left">
                <button type="button" class="btn btn-primary btn-sm btn-icon-text">
                    <i class="mdi mdi-arrow-right-thin"></i> <span class="d-none d-sm-inline">Go to Sales</span>
                </button>
            </div>

            <!-- Right side - Compact layout -->
            <div class="header-right d-flex align-items-center">
                <div class="d-flex align-items-center me-2">
                    <a href="#" class="pe-2 text-nowrap small">
                        <span class="d-none d-sm-inline">Dashboard</span>
                        <i class="mdi mdi-view-dashboard d-sm-none"></i>
                    </a>
                    <a href="#" class="ps-2 text-nowrap small">
                        <span class="d-none d-sm-inline">ADE-00234</span>
                        <i class="mdi mdi-identifier d-sm-none"></i>
                    </a>
                </div>
                <button type="button" class="btn btn-primary btn-sm btn-icon-text" (click)="requestToOrders()">
                    <i class="mdi mdi-arrow-left-thin"></i> <span class="d-none d-sm-inline">Go to Orders</span>
                </button>
            </div>
        </div>
    </div>
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Left Side - Medicine Selection (Full width on mobile) -->
            <div class="col-12 col-md-6 mb-3 mb-md-0">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Available Medicines</h5>
                    </div>
                    <div class="card-body card-body-padding">
                        <!-- Mobile Search Filter -->
                        <!-- Desktop Table (hidden on mobile) -->
                        <div class="d-none d-md-block">
                            <div class="table-responsive"
                                [ngClass]="{'scrollable-table': pharmacyMedicines.length > 50}">
                                <table class="table table-bordered">
                                    <thead class="thead-dark" style="background-color: gray;">
                                        <tr>
                                            <th>Medicine</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let medicine of pharmacyMedicines">
                                            <td>{{ medicine.medicineName }}</td>
                                            <td>{{ medicine.pricePerUnit | currency }}</td>
                                            <td>
                                                <span [class.text-danger]="medicine.stockQuantity <= 0">
                                                    {{ medicine.stockQuantity }}
                                                </span>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-success" (click)="addToCart(medicine)"
                                                    [disabled]="medicine.stockQuantity <= 0">
                                                    <i class="mdi mdi-cart"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Mobile Medicine Cards -->
                        <div class="d-block d-md-none">
                            <div class="row">
                                <div *ngFor="let medicine of pharmacyMedicines" class="col-12 mb-2">
                                    <div class="card mobile-medicine-card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-0">{{ medicine.medicineName }}</h6>
                                                    <small class="text-muted">{{ medicine.pricePerUnit | currency
                                                        }}</small>
                                                </div>
                                                <div class="text-end">
                                                    <span class="d-block"
                                                        [class.text-danger]="medicine.stockQuantity <= 0">
                                                        Stock: {{ medicine.stockQuantity }}
                                                    </span>
                                                    <button class="btn btn-sm btn-success mt-1"
                                                        (click)="addToCart(medicine)"
                                                        [disabled]="medicine.stockQuantity <= 0">
                                                        <i class="mdi mdi-cart"></i> Add
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side - Cart Form (Full width on mobile) -->
            <div class="col-12 col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Order Details</h5>
                    </div>
                    <div class="card-body">
                        <form #orderForm="ngForm" (ngSubmit)="submitOrder()">
                            <!-- Patient Information -->
                            <div class="form-group mb-3">
                                <label for="patientName">Patient Name</label>
                                <input type="text" class="form-control" id="patientName" [(ngModel)]="orderRequest.name"
                                    name="patientName" required>
                            </div>

                            <div class="form-group mb-3">
                                <label for="patientPhone">Phone Number</label>
                                <input type="tel" class="form-control" id="patientPhone"
                                    [(ngModel)]="orderRequest.phone" name="patientPhone" required>
                            </div>

                            <div class="form-group mb-3">
                                <label for="hospital">Hospital</label>
                                <select class="form-control custom-arrow" id="hospital"
                                    [(ngModel)]="orderRequest.hospitalId" name="hospital">
                                    <option value="">Select Hospital</option>
                                    <option *ngFor="let hospital of hospitalInformation" [value]="hospital.hospitalId">
                                        {{ hospital.hospitalName }}
                                    </option>
                                </select>
                            </div>

                            <div class="form-group mb-3">
                                <label for="doctorName">Doctor Name</label>
                                <input type="text" class="form-control" id="doctorName"
                                    [(ngModel)]="orderRequest.doctorName" name="doctorName">
                            </div>

                            <div class="form-group mb-3">
                                <label for="notes">Notes</label>
                                <textarea class="form-control" id="notes" rows="2" [(ngModel)]="orderRequest.notes"
                                    name="notes"></textarea>
                            </div>

                            <!-- Cart Items -->
                            <div class="cart-items mb-3">
                                <h6>Selected Medicines</h6>
                                <div *ngIf="orderRequest.pharmacyOrderRequestItemDetails.length === 0"
                                    class="alert alert-info">
                                    No items added to cart
                                </div>

                                <div class="table-responsive"
                                    *ngIf="orderRequest.pharmacyOrderRequestItemDetails.length > 0">
                                    <!-- Desktop Table (hidden on mobile) -->
                                    <table class="table table-sm d-none d-md-table">
                                        <thead>
                                            <tr>
                                                <th>Medicine</th>
                                                <th>Usage</th>
                                                <th>Qty</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr
                                                *ngFor="let item of orderRequest.pharmacyOrderRequestItemDetails; let i = index">
                                                <td>{{ item.medicineName }}</td>
                                                <td>
                                                    <input type="text" class="form-control form-control-sm"
                                                        [(ngModel)]="item.usage" [name]="'usage_' + i"
                                                        placeholder="Enter usage instructions">
                                                </td>
                                                <td>
                                                    <div class="input-group input-group-sm">
                                                        <button class="btn btn-outline-secondary"
                                                            (click)="decreaseQuantity(i)">-</button>
                                                        <input type="number" class="form-control text-center"
                                                            [(ngModel)]="item.itemQty" [name]="'qty_' + i" min="1"
                                                            [max]="item.medicineId ? getMaxQuantity(item.medicineId) : 0">
                                                        <button class="btn btn-outline-secondary"
                                                            (click)="increaseQuantity(i)">+</button>
                                                    </div>
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-danger" (click)="removeItem(i)">
                                                        <i class="mdi mdi-trash-can"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <!-- Mobile Cart Items -->
                                    <div class="d-block d-md-none">
                                        <div *ngFor="let item of orderRequest.pharmacyOrderRequestItemDetails; let i = index"
                                            class="mb-3 p-2 border rounded">
                                            <div class="d-flex justify-content-between mb-2">
                                                <strong>{{ item.medicineName }}</strong>
                                                <button class="btn btn-sm btn-danger" (click)="removeItem(i)">
                                                    <i class="mdi mdi-trash-can"></i>
                                                </button>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="small">Usage Instructions</label>
                                                <input type="text" class="form-control form-control-sm"
                                                    [(ngModel)]="item.usage" [name]="'usage_' + i"
                                                    placeholder="Enter usage instructions">
                                            </div>

                                            <div class="form-group">
                                                <label class="small">Quantity</label>
                                                <div class="input-group input-group-sm">
                                                    <button class="btn btn-outline-secondary"
                                                        (click)="decreaseQuantity(i)">-</button>
                                                    <input type="number" class="form-control text-center"
                                                        [(ngModel)]="item.itemQty" [name]="'qty_' + i" min="1"
                                                        [max]="item.medicineId ? getMaxQuantity(item.medicineId) : 0">
                                                    <button class="btn btn-outline-secondary"
                                                        (click)="increaseQuantity(i)">+</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Summary -->
                            <div class="order-summary mb-3 p-3 bg-light rounded">
                                <div class="d-flex justify-content-between">
                                    <strong>Total Items:</strong>
                                    <span>{{ orderRequest.pharmacyOrderRequestItemDetails.length }}</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <strong>Total Quantity:</strong>
                                    <span>{{ getTotalQuantity() }}</span>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-primary w-100"
                                [disabled]="orderForm.invalid || orderRequest.pharmacyOrderRequestItemDetails.length === 0">
                                <i class="mdi mdi-file"></i> Submit Order
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>